info:
  name: Stream Chat
  type: http
  seq: 1

http:
  method: POST
  url: "{{base_url}}/api/v1/chat/stream"
  headers:
    - name: Accept
      value: text/event-stream
    - name: X-User-Id
      value: "{{user_id}}"
  body:
    type: json
    data: |-
      {
        "workspace_id": "{{workspace_id}}",
        "thread_id": "{{thread_id}}",
        "messages": [
          {
            "role": "user",
            "content": "Hello, how can you help me?"
          }
        ],
        "agent_mode": "ptc",
        "plan_mode": false,
        "locale": "en-US",
        "timezone": "America/New_York"
      }
  auth: inherit

settings:
  encodeUrl: true
  timeout: 0
  followRedirects: true
  maxRedirects: 5

docs: |
  ## Stream Chat

  Stream PTC agent responses as Server-Sent Events (SSE).

  ### Features
  - Uses a Daytona sandbox session from the specified workspace
  - Streams agent responses in real-time
  - Supports tool execution and file operations
  - Handles interrupts for plan review (HITL)
  - Flash mode for fast responses without sandbox (external tools only)

  ### Prerequisites
  - Create a workspace first via `POST /api/v1/workspaces`
  - Set the `workspace_id` environment variable

  ### Request Body Fields
  - `workspace_id` (required unless agent_mode=flash): Workspace identifier
  - `thread_id` (optional): Thread identifier for checkpointing, defaults to auto-generated UUID
  - `messages`: Array of chat messages with role and content
  - `plan_mode`: When true, agent must submit plan for approval before execution
  - `agent_mode`: Agent mode - "ptc" (default) for sandbox-based execution, "flash" for fast responses without sandbox
  - `subagents_enabled`: List of subagent names to enable
  - `hitl_response`: Structured HITL response for resuming from interrupts
  - `checkpoint_id`: Specific checkpoint ID to resume from
  - `locale`: Locale for output language (e.g., 'en-US', 'zh-CN')
  - `timezone`: IANA timezone identifier
  - `llm_model`: Override LLM model from models.json

  ### Flash Mode
  When `agent_mode: "flash"` is set:
  - No workspace or sandbox is required (faster startup)
  - Uses external tools only: web search, market data, SEC filings
  - No code execution or MCP tools available
  - Optimized for quick lookups and simple Q&A

  Flash mode request example:
  ```json
  {
    "thread_id": "thread-123",
    "agent_mode": "flash",
    "messages": [
      {"role": "user", "content": "What is the current price of AAPL?"}
    ]
  }
  ```

  ### SSE Event Types
  - `message_chunk`: Text streaming from agents
  - `tool_call_chunks`: Incremental tool call arguments
  - `tool_calls`: Complete tool call
  - `tool_call_result`: Tool execution result
  - `interrupt`: Human-in-the-loop pause
  - `subagent_status`: Background task progress
  - `artifact`: File operation results
  - `error`: Execution errors
  - `keepalive`: Periodic heartbeat

  ### HITL Resume Example
  To resume from an interrupt with approval:
  ```json
  {
    "workspace_id": "ws-123",
    "thread_id": "thread-456",
    "hitl_response": {
      "interrupt-id-1": {
        "decisions": [
          {"type": "approve"}
        ]
      }
    },
    "messages": []
  }
  ```
